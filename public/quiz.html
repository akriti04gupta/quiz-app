<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KRAK THE CODE! - Quiz</title>

<!-- Inter Font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@600&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;}

html,body{
    width:100%;
    height:100%;
    background:#000;
    overflow:hidden;
    display:flex;
    justify-content:center;
    align-items:center;
    font-family:'Inter',sans-serif;
}

/* CANVAS */
.canvas-wrapper{
    position:relative;
    width:387px;
    height:688px;
    transform-origin:center center;
}

.canvas{
    position:absolute;
    width:387px;
    height:688px;
    background:url("/assets/second/background.png") no-repeat center;
    background-size:cover;
}

/* BACK BUTTON */
.page-back-link{
    position:absolute;
    left:23.1px;
    top:57.6px;
    width:30.9px;
    height:30.9px;
    z-index:20;
    display:block;
}

.page-back-circle{
    position:absolute;
    inset:0;
    width:100%;
    height:100%;
}

.page-back-arrow{
    position:absolute;
    width:13.7px;
    height:12.6px;
    left:8.6px;
    top:9px;
}

/* START SCREEN DESIGN (FIGMA 44:178) */
#startScreen{
    position:absolute;
    inset:0;
}

.title{
    position:absolute;
    left:46px;
    top:110px;
    width:300px;
    font-size:28px;
    font-weight:800;
    line-height:30.7px;
    letter-spacing:-0.56px;
    color:#fff;
}

.title span{color:#ff1703;}

.subtitle{
    position:absolute;
    left:46px;
    top:202px;
    width:300px;
    font-size:14.65px;
    font-weight:500;
    line-height:16.6px;
    color:#fff;
}

.input-section{
    position:absolute;
    left:46px;
    top:245px;
    width:232px;
}

.input-label{
    font-size:12.54px;
    font-weight:500;
    line-height:11.72px;
    color:#fff;
    margin-bottom:11px;
    display:block;
}

.input-field{
    width:100%;
    height:33.3px;
    padding:0 9px;
    border-radius:3.12px;
    border:1px solid rgba(0,0,0,0.08);
    background:#fff;
    font-size:15px;
    color:#111;
    outline:none;
}

.input-field::placeholder{
    color:#7a746e;
}

.begin-btn{
    position:absolute;
    top:340px;
    left:42px;
    width:192.5px;
    height:34px;
    border:none;
    border-radius:18.64px;
    background:#ff3b00;
    color:#fff;
    font-size:12.65px;
    font-weight:600;
    box-shadow:0 0 1.54px rgba(0,0,0,0.25);
    cursor:pointer;
}

.begin-btn:hover{filter:brightness(1.06);}

.section-badge{
    position:absolute;
    width:87.54px;
    height:27.18px;
    border-radius:10px;
    border:1px solid #e00000;
    background:rgba(255,23,3,0.3);
    backdrop-filter:blur(4.5px);
    display:flex;
    align-items:center;
    justify-content:center;
    color:#fff;
    font-size:10px;
    font-weight:700;
    box-shadow:0 0.83px 0.83px rgba(0,0,0,0.25);
}

.today-badge{left:46px;top:440px;}
.alltime-badge{left:46px;top:564px;}

.stats-row{
    position:absolute;
    left:46px;
    display:flex;
    gap:6px;
}

.today-stats{top:479px;}
.alltime-stats{top:603px;}

.stat-item{
    height:58.3px;
    padding:8.9px;
    border-radius:11.87px;
    background:rgba(40,40,40,0.8);
    backdrop-filter:blur(5px);
    box-shadow:0 0.99px 0.99px rgba(0,0,0,0.25);
    color:#fff;
    display:flex;
    flex-direction:column;
    justify-content:center;
}

.today-stats .stat-item:first-child{width:103.9px;}
.today-stats .stat-item:last-child{width:187.1px;}
.alltime-stats .stat-item:first-child{width:112.5px;}
.alltime-stats .stat-item:last-child{width:187.1px;}

.stat-label{
    font-size:13.6px;
    line-height:15px;
    letter-spacing:-0.28px;
    font-weight:600;
    color:#fff;
}

.stat-value{
    font-size:19.3px;
    font-weight:800;
    line-height:21.2px;
    letter-spacing:-0.38px;
    color:#ff3b00;
    white-space:nowrap;
}

.stat-name{
    display:none;
}

.hidden{display:none!important;}

.name-popup-overlay{
    position:absolute;
    inset:0;
    background:rgba(0,0,0,0.6);
    backdrop-filter:blur(2px);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:200;
}

.name-popup{
    width:280px;
    background:#151515;
    border:1px solid rgba(255,255,255,0.15);
    border-radius:14px;
    box-shadow:0 10px 30px rgba(0,0,0,0.45);
    padding:18px 16px 14px;
    color:#fff;
}

.name-popup-title{
    font-size:16px;
    font-weight:600;
    line-height:20px;
    margin-bottom:8px;
}

.name-popup-text{
    font-size:13px;
    font-weight:500;
    line-height:18px;
    color:#e7e7e7;
    margin-bottom:14px;
}

.name-popup-actions{
    display:flex;
    justify-content:flex-end;
}

.name-popup-ok{
    border:none;
    border-radius:18px;
    min-width:72px;
    height:34px;
    padding:0 18px;
    background:#ff3b00;
    color:#fff;
    font-size:12.65px;
    font-weight:600;
    cursor:pointer;
    box-shadow:0 0 1.54px rgba(0,0,0,0.25);
}

.name-popup-ok:hover{
    filter:brightness(1.06);
}
</style>
</head>

<body>

<div class="canvas-wrapper" id="wrapper">
    <div class="canvas"></div>

    <!-- BACK BUTTON -->
    <a href="index.html" class="page-back-link" aria-label="Back">
    <img src="https://www.figma.com/api/mcp/asset/14c094bc-6c42-42e4-8320-320d05e2f8b4" class="page-back-circle" alt="">
    <img src="https://www.figma.com/api/mcp/asset/fe07058e-0fab-4580-92e7-5913af05ba02" class="page-back-arrow" alt="">
    </a>


    <!-- START SCREEN -->
    <div id="startScreen">
        <h1 class="title">Welcome to<br>KRAK THE <span>CODE!</span></h1>
        <div class="subtitle">Please enter your name to sign in.</div>

        <div class="input-section">
            <label class="input-label">Full Name</label>
            <input id="playerName" class="input-field" placeholder="Enter your full name">
        </div>

        <!-- BEGIN BUTTON -->
        <button class="begin-btn" id="startBtn">Let's Begin</button>

        <!-- TODAY -->
        <div class="section-badge today-badge">Todayâ€™s Best!</div>

        <div class="stats-row today-stats">
            <div class="stat-item">
                <div class="stat-label">Top score:</div>
                <div id="todayTopScore" class="stat-value">0 Coins</div>
                <div id="todayTopName" class="stat-name">-</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Fastest Completion Time:</div>
                <div id="todayFastestTime" class="stat-value">00:00</div>
            </div>
        </div>

        <!-- ALL TIME -->
        <div class="section-badge alltime-badge">All Time Best!</div>

        <div class="stats-row alltime-stats">
            <div class="stat-item">
                <div class="stat-label">Top score:</div>
                <div id="allTimeTopScore" class="stat-value">0 Coins</div>
                <div id="allTimeTopName" class="stat-name">-</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Fastest Completion Time:</div>
                <div id="allTimeFastestTime" class="stat-value">00:00</div>
            </div>
        </div>

    </div>

    <div id="namePopupOverlay" class="name-popup-overlay" role="dialog" aria-modal="true" aria-labelledby="namePopupTitle">
        <div class="name-popup">
            <div id="namePopupTitle" class="name-popup-title">KRAK THE CODE!</div>
            <div class="name-popup-text">Please enter your name to continue.</div>
            <div class="name-popup-actions">
                <button id="namePopupOk" class="name-popup-ok" type="button">OK</button>
            </div>
        </div>
    </div>
</div>

<script>
function scaleCanvas(){
    const wrapper=document.getElementById("wrapper");
    const scale=Math.min(window.innerWidth/387,window.innerHeight/688);
    wrapper.style.transform=`scale(${scale})`;
}
scaleCanvas();
window.addEventListener("resize",scaleCanvas);

document.getElementById("startBtn").onclick=function(){
    const name=document.getElementById("playerName").value.trim();
    if(!name){
        showNamePopup();
        return;
    }
    localStorage.setItem("playerName", name);
    window.location.href="howtoplay.html";
};

document.getElementById("playerName").addEventListener("keypress", function(e){
    if(e.key === "Enter"){
        document.getElementById("startBtn").click();
    }
});

function showNamePopup(){
    const popup = document.getElementById('namePopupOverlay');
    popup.style.display = 'flex';
}

function hideNamePopup(){
    const popup = document.getElementById('namePopupOverlay');
    popup.style.display = 'none';
    document.getElementById('playerName').focus();
}

document.getElementById('namePopupOk').addEventListener('click', hideNamePopup);
document.getElementById('namePopupOverlay').addEventListener('click', (e) => {
    if(e.target.id === 'namePopupOverlay'){
        hideNamePopup();
    }
});

async function loadLeaderboard(){
    try{
        const res=await fetch('/api/quiz/leaderboard');
        const data=await res.json();

        if(data.today?.[0]){
            const todayCoins = data.today[0].points ?? (data.today[0].score * 10);
            document.getElementById('todayTopScore').textContent=todayCoins+" Coins";
            document.getElementById('todayFastestTime').textContent=formatTime(data.today[0].timeTaken||0);
            document.getElementById('todayTopName').textContent=data.today[0].playerName || 'Anonymous';
        }

        if(data.allTime?.[0]){
            const allTimeCoins = data.allTime[0].points ?? (data.allTime[0].score * 10);
            document.getElementById('allTimeTopScore').textContent=allTimeCoins+" Coins";
            document.getElementById('allTimeFastestTime').textContent=formatTime(data.allTime[0].timeTaken||0);
            document.getElementById('allTimeTopName').textContent=data.allTime[0].playerName || 'Anonymous';
        }
    }catch(e){}
}

function formatTime(s){
    const n = parseInt(s);
    const m=Math.floor(n/60);
    const sec=n%60;
    return m.toString().padStart(2,'0')+":"+sec.toString().padStart(2,'0');
}

loadLeaderboard();
</script>

</body>
</html>
